<!--TABLE-->
<div class="card">
  <div class="flex items-center justify-between mb-6">
    <h3 class="font-bold">Users</h3>
    <div class="flex gap-2">
      <app-button-export [nameOfTable]="'Users'" [data]="_usersTableRow()" />
      <app-button-create
        [size]="24"
        (click)="openCreateUserModal()"
      ></app-button-create>
    </div>
  </div>
  <div class="overflow-x-auto dark:bg-secondary-dark rounded-lg">
    <table class="min-w-full divide-y dark:divide-gray-100">
      <thead>
        <tr>
          <th class="px-4 py-2 text-left">#</th>
          <th class="px-4 py-2 text-left">Avatar</th>
          <th class="px-4 py-2 text-left">Username</th>
          <th class="px-4 py-2 text-left">Name</th>
          <th class="px-4 py-2 text-left">Role</th>
          <th class="px-4 py-2 text-left">Status</th>
          <th class="px-4 py-2 text-left">Creation Date</th>
          <th class="px-4 py-2 text-left">Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (user of _usersTableRow(); track user.id; let idx = $index,e
        =$even) {
        <tr class="border-b border-gray-200 dark:border-white/10">
          <td class="px-4 py-2 font-semibold text-gray-900 dark:text-white">
            {{ idx + 1 }}
          </td>
          <td class="px-4 py-2">
            @if (user.photo) {
            <img
              [src]="user.photo"
              alt="Photo of {{ user.firstName }} {{ user.lastName }}"
              class="w-10 h-10 rounded-full object-cover border-2 border-white dark:border-neutral-700 shadow"
            />
            } @else {
            <div
              class="w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm shadow border-2 border-white dark:border-neutral-700"
              [ngStyle]="{
                'background-color': getBackgroundColor(
                  user.firstName + user.lastName
                )
              }"
            >
              {{ getInitials(user.firstName, user.lastName) }}
            </div>
            }
          </td>
          <td class="px-4 py-2 text-gray-900 dark:text-white">
            {{ user.username }}
          </td>
          <td class="px-4 py-2 text-gray-900 dark:text-white">
            {{ user.firstName }} {{ user.lastName }}
          </td>
          <td class="px-4 py-2 text-gray-900 dark:text-white">
            {{ user.roleName }}
          </td>
          <td class="px-4 py-2">
            @if (user.status === 1) {
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 border border-green-300 dark:border-green-700"
            >
              Active
            </span>
            } @else {
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 border border-red-300 dark:border-red-700"
            >
              Inactive
            </span>
            }
          </td>
          <td class="px-4 py-2 text-gray-900 dark:text-white">
            {{ user.created_at | date : "dd/MM/yyyy" }}
          </td>
          <td class="px-4 py-2 h-full">
            <div class="flex gap-2 justify-center items-center h-full">
              <button
                type="button"
                class="cursor-pointer text-gray-900 hover:text-primary-500 dark:text-white"
                (click)="openShowUserModal(user.id)"
              >
                <svg class="w-5 h-5 mr-2">
                  <use [attr.href]="getIconHref('eye')"></use>
                </svg>
              </button>
              <button
                type="button"
                class="cursor-pointer text-gray-900 hover:text-primary-500 dark:text-white"
                (click)="openUpdateUserModal(user.id)"
              >
                <svg class="w-5 h-5 mr-2">
                  <use [attr.href]="getIconHref('pencil')"></use>
                </svg>
              </button>
              <button
                type="button"
                class="cursor-pointer text-gray-900 hover:text-primary-500 dark:text-white"
                (click)="deleteUser(user.id)"
              >
                <svg class="w-5 h-5 mr-2">
                  <use [attr.href]="getIconHref('trash-2')"></use>
                </svg>
              </button>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>
@if (modalType() === 'create-user') {
<app-generic-modal
  [isOpen]="true"
  title="Create User"
  (closed)="closeModal()"
>
  <app-user-form
    [roles]="_roles()"
    [employees]="_employees()"
    (saveUser)="submitUser($event)"
  >
  </app-user-form>
</app-generic-modal>
} @if (modalType() === 'show-user') {
<app-generic-modal
  [isOpen]="true"
  title="User Profile"
  (closed)="closeModal()"
>
  <app-user-profile [user]="modalData()" />
</app-generic-modal>

} @if (modalType() === 'update-user') {
<app-generic-modal
  [isOpen]="true"
  title="Edit User"
  (closed)="closeModal()"
>
  <app-user-form
    [initialUser]="modalData()"
    [roles]="_roles()"
    [employees]="_employees()"
    (saveUser)="submitUser($event)"
  />
</app-generic-modal>
}
