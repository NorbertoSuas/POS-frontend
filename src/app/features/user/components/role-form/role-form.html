<!-- role-form.html -->
<form
  [formGroup]="form"
  novalidate
  class="grid grid-cols-1 md:grid-cols-2 gap-6 dark:bg-secondary-dark p-3 rounded-2xl"
>
  <!-- Role name -->
  <div class="flex flex-col gap-1">
    <label for="name" class="block text-sm font-medium mb-1">Name</label>
    <input
      id="name"
      formControlName="name"
      type="text"
      class="w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-primary focus:border-primary"
      [class.border-red-500]="form.get('name')?.touched && form.get('name')?.invalid"
    />
    @if (form.get('name')?.touched && form.get('name')?.invalid) {
    <p class="mt-1 text-red-600 text-sm">Required field</p>
    }
  </div>

  <!-- Role description -->
  <div class="flex flex-col gap-1">
    <label for="description" class="block text-sm font-medium mb-1">
      Description
    </label>
    <input
      id="description"
      formControlName="description"
      type="text"
      class="w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-primary focus:border-primary"
    />
  </div>

  <!-- Permissions Section -->
  <div class="flex flex-col items-center col-span-full">
    <label class="block text-base font-semibold mb-3 text-center">
      Permissions
    </label>
    
    <div formArrayName="permissions" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 w-full max-w-2xl">
      @for (permission of permissionList(); track permission.id; let i = $index) {
        <div class="flex items-center justify-between gap-3 p-3 rounded-lg w-full">
          <span class="text-sm font-medium">
            {{ permission.name }}
          </span>
          <input
            type="checkbox"
            [formControl]="permissionsArray.at(i)"
            class="toggle toggle-lg text-primary-400/40 checked:bg-primary-light checked:text-primary-500 dark:checked:bg-primary-500/50"
          />
        </div>
      }
    </div>
    
    <!-- Error messages for permissions -->
    @if (permissionsArray.errors?.['noPermissionsSelected'] && permissionsArray.touched) {
      <p class="mt-2 text-red-600 text-sm text-center">
        You must select at least one permission
      </p>
    }
    @if (permissionsArray.errors?.['noPermissionsAvailable']) {
      <p class="mt-2 text-red-600 text-sm text-center">
        No permissions available
      </p>
    }
  </div>

  <!-- Save button -->
  <div class="col-span-full mt-2">
    <button
      type="button"
      class="w-full bg-primary-500 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-lg transition duration-200 flex justify-center items-center"
      [disabled]="form.invalid || submitting()"
      [class.opacity-50]="form.invalid || submitting()"
      (click)="submit()"
    >
      @if (submitting()) {
        <svg class="animate-spin -ml-1 mr-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Saving...
      } @else {
        Save
      }
    </button>
  </div>
</form>