<div class="container mx-auto p-6">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100">Cash Register Management</h1>
      <p class="text-gray-600 dark:text-gray-400 mt-2">Manage cash registers, create new ones, and monitor their status</p>
    </div>
    <button 
      type="button"
      class="btn btn-primary" 
      (click)="goBack()"
    >
      <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
      </svg>
      Back to Dashboard
    </button>
  </div>

  <!-- Statistics Cards -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
    <div class="stat bg-gray-100 dark:bg-gray-800 rounded-lg">
      <div class="stat-title">Total Registers</div>
      <div class="stat-value text-primary">{{ getTotalCashRegisters() }}</div>
    </div>
    <div class="stat bg-gray-100 dark:bg-gray-800 rounded-lg">
      <div class="stat-title">Active Registers</div>
      <div class="stat-value text-success">{{ getActiveCashRegisters() }}</div>
    </div>
    <div class="stat bg-gray-100 dark:bg-gray-800 rounded-lg">
      <div class="stat-title">Total Balance</div>
      <div class="stat-value text-info">{{ formatCurrency(getTotalBalance()) }}</div>
    </div>
    <div class="stat bg-gray-100 dark:bg-gray-800 rounded-lg">
      <div class="stat-title">Average Balance</div>
      <div class="stat-value text-warning">{{ formatCurrency(getAverageBalance()) }}</div>
    </div>
  </div>

  <!-- Controls -->
  <div class="card bg-white dark:bg-gray-900 shadow-xl mb-6">
    <div class="card-body">
      <div class="flex flex-col lg:flex-row gap-4 items-center justify-between">
        <!-- Search -->
        <div class="form-control w-full lg:w-96">
          <label class="label" for="searchInput">
            <span class="label-text">Search Cash Registers</span>
          </label>
          <input 
            type="text" 
            id="searchInput"
            placeholder="Search by name or description..." 
            class="input input-bordered w-full"
            [(ngModel)]="searchTerm"
            (input)="onSearchChange()"
          >
        </div>

        <!-- Filters -->
        <div class="flex gap-4">
          <div class="form-control w-32">
            <label class="label" for="statusFilter">
              <span class="label-text">Status</span>
            </label>
            <select 
              id="statusFilter"
              class="select select-bordered"
              [(ngModel)]="statusFilter"
              (change)="onFilterChange()"
            >
              <option value="all">All</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>

          <div class="form-control w-32">
            <label class="label" for="branchFilter">
              <span class="label-text">Branch</span>
            </label>
            <select 
              id="branchFilter"
              class="select select-bordered"
              [(ngModel)]="branchFilter"
              (change)="onFilterChange()"
            >
              <option value="all">All</option>
              <option value="1">Branch 1</option>
              <option value="2">Branch 2</option>
            </select>
          </div>
        </div>

        <!-- Actions -->
        <div class="flex gap-2">
          <button 
            type="button"
            class="btn btn-primary"
            (click)="openCreateModal()"
          >
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            Create Register
          </button>
          <button 
            type="button"
            class="btn btn-outline"
            (click)="exportToCSV()"
          >
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            Export CSV
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="cashRegisterService.loading()" class="flex justify-center items-center py-8">
    <span class="loading loading-spinner loading-lg"></span>
  </div>

  <!-- Error State -->
  <div *ngIf="cashRegisterService.error()" class="alert alert-error mb-6">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    <span>{{ cashRegisterService.error() }}</span>
  </div>

  <!-- Cash Registers Table -->
  <div *ngIf="!cashRegisterService.loading()" class="card bg-white dark:bg-gray-900 shadow-xl">
    <div class="card-body p-0">
      <div class="overflow-x-auto">
        <table class="table table-zebra w-full">
          <thead>
            <tr>
              <th>Name</th>
              <th>Description</th>
              <th>Branch ID</th>
              <th>Initial Balance</th>
              <th>Current Balance</th>
              <th>Status</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let cashRegister of filteredCashRegisters; trackBy: trackByFn">
              <td>
                <div class="font-semibold">{{ cashRegister.name }}</div>
              </td>
              <td>
                <div class="text-sm text-gray-600 dark:text-gray-400 max-w-xs truncate">
                  {{ cashRegister.description || 'No description' }}
                </div>
              </td>
              <td>
                <span class="bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 px-2 py-1 rounded-full text-xs font-medium">{{ cashRegister.branchId }}</span>
              </td>
              <td>
                <span class="font-mono">{{ formatCurrency(cashRegister.initialBalance) }}</span>
              </td>
              <td>
                <span class="font-mono font-semibold">{{ formatCurrency(cashRegister.currentBalance) }}</span>
              </td>
              <td>
                <span class="px-2 py-1 rounded-full text-xs font-medium" [ngClass]="getStatusClass(getCashRegisterStatus(cashRegister))">
                  {{ getCashRegisterStatus(cashRegister) }}
                </span>
              </td>
              <td>
                <span class="text-sm">{{ formatDate(cashRegister.createdAt) }}</span>
              </td>
              <td>
                <div class="flex gap-2">
                    <button 
                      type="button"
                      class="btn btn-ghost btn-sm"
                      (click)="openEditModal(cashRegister)"
                      title="Edit"
                      aria-label="Edit cash register"
                    >
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                      </svg>
                      <span class="sr-only">Edit</span>
                    </button>
                  <button 
                    type="button"
                    class="btn btn-ghost btn-sm"
                    [ngClass]="cashRegister.isActive ? 'text-error' : 'text-success'"
                    (click)="toggleStatus(cashRegister)"
                    [title]="cashRegister.isActive ? 'Deactivate' : 'Activate'"
                    [attr.aria-label]="cashRegister.isActive ? 'Deactivate cash register' : 'Activate cash register'"
                  >
                    <svg *ngIf="cashRegister.isActive" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364l12.728-12.728"></path>
                    </svg>
                    <svg *ngIf="!cashRegister.isActive" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span class="sr-only">{{ cashRegister.isActive ? 'Deactivate' : 'Activate' }}</span>
                  </button>
                  <button 
                    type="button"
                    class="btn btn-ghost btn-sm text-error"
                    (click)="deleteCashRegister(cashRegister)"
                    title="Delete"
                    aria-label="Delete cash register"
                  >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                    <span class="sr-only">Delete</span>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Empty State -->
      <div *ngIf="filteredCashRegisters.length === 0" class="text-center py-8">
        <svg class="w-16 h-16 mx-auto text-gray-300 dark:text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        <h3 class="text-lg font-semibold text-gray-600 dark:text-gray-400 mb-2">No Cash Registers Found</h3>
        <p class="text-gray-500 dark:text-gray-500 mb-4">No cash registers match your current filters.</p>
        <button type="button" class="btn btn-primary" (click)="openCreateModal()">
          Create Your First Cash Register
        </button>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="totalPages > 1" class="flex justify-center mt-6">
    <app-pagination
      [currentPage]="currentPage"
      [totalItems]="totalItems"
      [pageSize]="itemsPerPage"
      (pageChange)="onPageChange($event)"
    ></app-pagination>
  </div>

  <!-- Pagination Info -->
  <div *ngIf="totalItems > 0" class="text-center mt-4 text-sm text-gray-600 dark:text-gray-400">
    {{ paginationInfo }}
  </div>
</div>

<!-- Create/Edit Modal -->
<app-generic-modal
  [isOpen]="showModal"
  [title]="editingCashRegister ? 'Edit Cash Register' : 'Create New Cash Register'"
  (close)="closeModal()"
>
  <form [formGroup]="cashRegisterForm" (ngSubmit)="saveCashRegister()">
    <div class="space-y-4">
      <!-- Name -->
      <div class="form-control">
        <label class="label" for="name">
          <span class="label-text">Name *</span>
        </label>
          <input 
            type="text" 
            id="name"
            placeholder="Enter cash register name"
            class="input input-bordered"
            [class.input-error]="isFieldInvalid('name')"
            formControlName="name"
          >
        <label class="label" *ngIf="isFieldInvalid('name')" for="name">
          <span class="label-text-alt text-error">{{ getFieldError('name') }}</span>
        </label>
      </div>

      <!-- Description -->
      <div class="form-control">
        <label class="label" for="description">
          <span class="label-text">Description</span>
        </label>
          <textarea 
            id="description"
            placeholder="Enter description (optional)"
            class="textarea textarea-bordered"
            [class.textarea-error]="isFieldInvalid('description')"
            formControlName="description"
            rows="3"
          ></textarea>
        <label class="label" *ngIf="isFieldInvalid('description')" for="description">
          <span class="label-text-alt text-error">{{ getFieldError('description') }}</span>
        </label>
      </div>

      <!-- Branch ID -->
      <div class="form-control">
        <label class="label" for="branchId">
          <span class="label-text">Branch ID *</span>
        </label>
          <select 
            id="branchId"
            class="select select-bordered"
            [class.select-error]="isFieldInvalid('branchId')"
            formControlName="branchId"
          >
          <option value="">Select a branch</option>
          <option value="1">Branch 1</option>
          <option value="2">Branch 2</option>
        </select>
        <label class="label" *ngIf="isFieldInvalid('branchId')" for="branchId">
          <span class="label-text-alt text-error">{{ getFieldError('branchId') }}</span>
        </label>
      </div>

      <!-- Initial Balance -->
      <div class="form-control">
        <label class="label" for="initialBalance">
          <span class="label-text">Initial Balance *</span>
        </label>
          <input 
            type="number" 
            id="initialBalance"
            step="0.01"
            min="0"
            max="999999.99"
            placeholder="0.00"
            class="input input-bordered"
            [class.input-error]="isFieldInvalid('initialBalance')"
            formControlName="initialBalance"
          >
        <label class="label" *ngIf="isFieldInvalid('initialBalance')" for="initialBalance">
          <span class="label-text-alt text-error">{{ getFieldError('initialBalance') }}</span>
        </label>
      </div>
    </div>

    <!-- Modal Actions -->
    <div class="modal-action">
      <button type="button" class="btn btn-ghost" (click)="closeModal()">
        Cancel
      </button>
      <button 
        type="submit" 
        class="btn btn-primary"
        [disabled]="cashRegisterForm.invalid || cashRegisterService.loading()"
      >
        <span *ngIf="cashRegisterService.loading()" class="loading loading-spinner loading-sm mr-2"></span>
        {{ editingCashRegister ? 'Update' : 'Create' }}
      </button>
    </div>
  </form>
</app-generic-modal>
